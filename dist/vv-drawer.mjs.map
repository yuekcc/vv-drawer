{"version":3,"file":"vv-drawer.mjs","sources":["../src/keys.js","../src/DrawerContainer.vue","../src/index.js"],"sourcesContent":["export const DRAWER_HANDLER = Symbol('drawer_handler');\r\n","<script setup>\r\nimport { onMounted, provide, ref } from 'vue';\r\nimport { DRAWER_HANDLER } from './keys';\r\n\r\nconst props = defineProps({\r\n  emitClose: { type: Function, required: true },\r\n  emitOk: { type: Function, required: true },\r\n  width: { type: String, default: '70%' },\r\n  closeOnMask: { type: Boolean, default: true },\r\n  customClass: { type: String, default: '' },\r\n});\r\n\r\nconst canShowBody = ref(false);\r\n\r\nonMounted(() => {\r\n  setTimeout(() => {\r\n    canShowBody.value = true;\r\n  }, 0);\r\n});\r\n\r\nconst wrappedEmitClose = () => {\r\n  canShowBody.value = false;\r\n  setTimeout(() => {\r\n    props.emitClose();\r\n  }, 330);\r\n};\r\n\r\nconst wrappedEmitOk = data => {\r\n  props.emitOk(data);\r\n};\r\n\r\nprovide(DRAWER_HANDLER, {\r\n  emitClose: wrappedEmitClose,\r\n  emitOk: wrappedEmitOk,\r\n});\r\n\r\nfunction clickOnMask() {\r\n  if (props.closeOnMask) {\r\n    wrappedEmitClose();\r\n  }\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"drawer-container\" :class=\"customClass\">\r\n    <div class=\"mask\" @click=\"clickOnMask\"></div>\r\n    <transition name=\"fade-in-right\">\r\n      <div v-if=\"canShowBody\" class=\"body\" :style=\"{ width }\">\r\n        <slot></slot>\r\n      </div>\r\n    </transition>\r\n  </div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n:root {\r\n  --animation-delay: 0.3s;\r\n}\r\n\r\n.fade-in-right-enter-active {\r\n  animation: fadeInRight var(--animation-delay);\r\n}\r\n\r\n.fade-in-right-leave-active {\r\n  animation: fadeOutRight var(--animation-delay);\r\n}\r\n\r\n@keyframes fadeInRight {\r\n  from {\r\n    opacity: 0;\r\n    transform: translate3d(100%, 0, 0);\r\n  }\r\n\r\n  to {\r\n    opacity: 1;\r\n    transform: translate3d(0, 0, 0);\r\n  }\r\n}\r\n\r\n@keyframes fadeOutRight {\r\n  from {\r\n    opacity: 1;\r\n  }\r\n\r\n  to {\r\n    opacity: 0;\r\n    transform: translate3d(100%, 0, 0);\r\n  }\r\n}\r\n\r\n.drawer-container {\r\n  position: fixed;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  z-index: 2;\r\n\r\n  .mask {\r\n    position: fixed;\r\n    top: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    left: 0;\r\n    z-index: 3;\r\n\r\n    background-color: rgba(0, 0, 0, 0.5);\r\n  }\r\n\r\n  .body {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background-color: #fff;\r\n    z-index: 10;\r\n    box-shadow: 0px 16px 48px 16px rgba(0, 0, 0, 0.08), 0px 12px 32px rgba(0, 0, 0, 0.12),\r\n      0px 8px 16px -8px rgba(0, 0, 0, 0.16);\r\n  }\r\n}\r\n</style>\r\n","import { createApp, h, inject, onMounted, ref } from 'vue';\r\nimport DrawerContainer from './DrawerContainer.vue';\r\nimport { DRAWER_HANDLER } from './keys';\r\n\r\n\r\n\r\nfunction makeDrawerComponent(options, clean) {\r\n  const { component, onClose, onOk, width, closeOnMask, customClass, propsData } = options;\r\n\r\n  return {\r\n    setup() {\r\n      const canShowDrawerContainer = ref(false);\r\n      onMounted(() => {\r\n        canShowDrawerContainer.value = true;\r\n      });\r\n\r\n      const wrappedEmitClose = () => {\r\n        canShowDrawerContainer.value = false;\r\n        onClose();\r\n        setTimeout(clean, 0);\r\n      };\r\n\r\n      const wrappedEmitOk = data => {\r\n        onOk(data);\r\n      };\r\n\r\n      const drawerContainerProps = {\r\n        width,\r\n        closeOnMask,\r\n        customClass,\r\n        emitClose: wrappedEmitClose,\r\n        emitOk: wrappedEmitOk,\r\n      };\r\n\r\n      return () => {\r\n        if (canShowDrawerContainer.value) {\r\n          return h(DrawerContainer, drawerContainerProps, { default: () => h(component, propsData) });\r\n        }\r\n\r\n        return null;\r\n      };\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * 打开一个 Drawer 窗口\r\n * @returns {(options: {\r\n *  component: object;\r\n *  onClose: () => void;\r\n *  onOk: (data: unknown) => void;\r\n *  closeOnMask?: boolean;\r\n *  width?: string;\r\n *  customClass?: string }) => void}\r\n */\r\nexport function useDrawer() {\r\n  let el = null;\r\n  let app = null;\r\n\r\n  const clean = () => {\r\n    if (app) {\r\n      app.unmount();\r\n      app = null;\r\n    }\r\n\r\n    if (el) {\r\n      el.remove();\r\n      el = null;\r\n    }\r\n  };\r\n\r\n  return options => {\r\n    app = createApp(makeDrawerComponent(options, clean));\r\n\r\n    el = document.createElement('div');\r\n    document.body.append(el);\r\n    app.mount(el);\r\n  };\r\n}\r\n\r\n/**\r\n * 使用 Drawer 服务，用于获取 Drawer 窗口的控制函数\r\n * @returns {{emitClose: () => void; emitOk: (data: unknown) => void;}}\r\n */\r\nexport function useDrawerService() {\r\n  return inject(DRAWER_HANDLER);\r\n}\r\n"],"names":["DRAWER_HANDLER","canShowBody","ref","onMounted","wrappedEmitClose","props","provide","data","clickOnMask","makeDrawerComponent","options","clean","component","onClose","onOk","width","closeOnMask","customClass","propsData","canShowDrawerContainer","drawerContainerProps","h","DrawerContainer","useDrawer","el","app","createApp","useDrawerService","inject"],"mappings":";AAAO,MAAMA,IAAiB,OAAO,gBAAgB;;;;;;;;;;;iBCY/CC,IAAcC,EAAI,EAAK;AAE7B,IAAAC,EAAU,MAAM;AACd,iBAAW,MAAM;AACf,QAAAF,EAAY,QAAQ;AAAA,MACrB,GAAE,CAAC;AAAA,IACN,CAAC;AAED,UAAMG,IAAmB,MAAM;AAC7B,MAAAH,EAAY,QAAQ,IACpB,WAAW,MAAM;AACf,QAAAI,EAAM,UAAS;AAAA,MAChB,GAAE,GAAG;AAAA,IACR;AAMA,IAAAC,EAAQN,GAAgB;AAAA,MACtB,WAAWI;AAAA,MACX,QANoB,CAAAG,MAAQ;AAC5B,QAAAF,EAAM,OAAOE,CAAI;AAAA,MACnB;AAAA,IAKA,CAAC;AAED,aAASC,IAAc;AACrB,MAAIH,EAAM,eACRD;IAEJ;;;;;;;;;;;;;;;;;;;;;;;AClCA,SAASK,EAAoBC,GAASC,GAAO;AAC3C,QAAM,EAAE,WAAAC,GAAW,SAAAC,GAAS,MAAAC,GAAM,OAAAC,GAAO,aAAAC,GAAa,aAAAC,GAAa,WAAAC,EAAW,IAAGR;AAEjF,SAAO;AAAA,IACL,QAAQ;AACN,YAAMS,IAAyBjB,EAAI,EAAK;AACxC,MAAAC,EAAU,MAAM;AACd,QAAAgB,EAAuB,QAAQ;AAAA,MACvC,CAAO;AAYD,YAAMC,IAAuB;AAAA,QAC3B,OAAAL;AAAA,QACA,aAAAC;AAAA,QACA,aAAAC;AAAA,QACA,WAduB,MAAM;AAC7B,UAAAE,EAAuB,QAAQ,IAC/BN,KACA,WAAWF,GAAO,CAAC;AAAA,QAC3B;AAAA,QAWQ,QAToB,CAAAJ,MAAQ;AAC5B,UAAAO,EAAKP,CAAI;AAAA,QACjB;AAAA,MAQA;AAEM,aAAO,MACDY,EAAuB,QAClBE,EAAEC,GAAiBF,GAAsB,EAAE,SAAS,MAAMC,EAAET,GAAWM,CAAS,EAAC,CAAE,IAGrF;AAAA,IAEV;AAAA,EACL;AACA;AAYO,SAASK,IAAY;AAC1B,MAAIC,IAAK,MACLC,IAAM;AAEV,QAAMd,IAAQ,MAAM;AAClB,IAAIc,MACFA,EAAI,QAAO,GACXA,IAAM,OAGJD,MACFA,EAAG,OAAM,GACTA,IAAK;AAAA,EAEX;AAEE,SAAO,CAAAd,MAAW;AAChB,IAAAe,IAAMC,EAAUjB,EAAoBC,GAASC,CAAK,CAAC,GAEnDa,IAAK,SAAS,cAAc,KAAK,GACjC,SAAS,KAAK,OAAOA,CAAE,GACvBC,EAAI,MAAMD,CAAE;AAAA,EAChB;AACA;AAMO,SAASG,IAAmB;AACjC,SAAOC,EAAO5B,CAAc;AAC9B;"}